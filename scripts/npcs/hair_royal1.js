/**
 * 自選髮型-新端腳本修改
 **/

var itemH = 5150040;//皇家理髮
var itemF = 5152053;//皇家整容
//男生髮型
var manStyleHair = [
    43290,
    33240,
    35110,
    43430,
    30565,
    43332,
    43320,
    43325,
    43747,
    35180,
    31720,
    31730,
    35090,
    35290,
    35330,
    35360,
    35430,
    35440,
    35470,
    35510,
    35560,
    35630,
    35650,
    33150,
    40837,
    40021,
    40065,
    30431,
    35306,
    44467,
    36750,
    33435,
    35331,
    35056,
    41770,
    42013,
    36300,
    33644,
    36517,
    35265,
    31993,
    35650,
    33006,
    35441,
    35221,
    41521,
    41484,
    40054,
    35720,
    37630,
    36181,
    36517,
    33251,
    36490,
    41594,
    35430,
    40816,
    36860,
    36760,
    40285,
    33810,
    31403,
    31643,
    33003,
    33043,
    33053,
    33063,
    33113,
    33133,
    33183,
    33215,
    33233,
    33273,
    33283,
    33293,
    33403,
    33623,
    33643,
    33833,
    33813,
    35013,
    35123,
    35133,
    35143,
    35563,
    35693,
    36310,//男發自選1
    40023,
    40043,
    40053,
    40063,
    40103,
    40263,
    40273,
    40283,
    40393,
    40413,
    40423,
    40433,
    40493,
    40513,
    40523,
    40533,
    40543,
    40573,
    40583,
    40643,
    40673,
    40723,
    40733,
    36310,
    35683,
    35703,
    35723,
    35763,
    35773,
    35783,
    35793,
    35953,
    35963,
    36003,
    36093,
    36123,
    36133,
    36163,
    36173,
    36213,
    36193,
    36223,
    36533,
    36583,
    36633,
    36643,
    36703,
    36933,
    36953,
    36310,//男發自選2
    32500, 35950, 36500, 35290, 35710, 35720, 35770, 35800, 35440, 35430, 35500, 35350, 35340, 35600, 35630,
    35750, 35730, 35721, 35712, 35705, 35693, 35550, 35084, 35063, 35211, 35360, 35330, 35460, 35440, 35430,
    35560, 35602, 36340, 35090, 35080, 35160, 35150, 35130, 35120, 35110, 35100, 35190, 35240, 35230, 35220,
    35350, 36130, 36160, 36140, 36170, 36480, 36470, 36460, 36450, 36620, 36630, 36640, 36650, 36670, 36690,
    36710, 36730, 36740, 36750, 36760, 36770, 36800, 36820, 36840, 36860, 36890, 36900, 36920, 36930, 36980,
    36940, 36990, 33380, 33750, 33790, 34370, 34940, 35000, 35010, 35020, 35030, 35040, 35050, 35070, 37690,
    37890, 31870, 32470, 32490, 33645, 35060, 35180, 35200, 35210, 35260, 35340, 36230, 36680, 36490, 36810,
    36830, 36880, 36950, 37120, 35690, 36700 //皇家130男髮型
];
//女生髮型
var womanStyleHair = [
    44770,
    44030,
    41900,
    41960,
    47380,
    47090,
    44330,
    26814,
    37053,
    37063,
    37213,
    37223,
    37303,
    37453,
    37463,
    37633,
    37823,
    37863,
    37883,
    37903,
    37923,
    37933,
    37963,
    38073,
    38113,
    38153,
    38163,
    38223,
    38763,
    38813,
    38933,
    38943,
    38630,
    41083,
    41093,
    41123,
    41163,
    41193,
    41343,
    41463,
    41523,
    41583,
    41553,
    41513,
    41633,
    41643,
    41663,
    41683,
    41703,
    41713,
    41723,
    41743,
    41753,
    41763,
    41773,
    41783,
    41803,
    41833,
    38630,//女發自選1
    31993,
    44500,
    43730,
    44991,
    44980,
    44994,
    43733,
    44651,
    37750,
    37990,
    38010,
    38120,
    37320,
    34866,
    34877,
    34770,
    38240,
    37230,
    38020,
    37670,
    41653,
    37617,
    37440,
    37706,
    30240,
    38151,
    38420,
    38393,
    38520,
    38500,
    37635,
    38485,
    38760,
    38610,
    34316,
    34457,
    35440,
    38807,
    38940,
    41374,
    34274,
    34954,
    37441,
    38790,
    37000,
    38580,
    38630,
    31493,
    31593,
    31613,
    31663,
    31633,
    31743,
    31763,
    31773,
    31843,
    31823,
    31903,
    33333,
    34163,
    34183,
    34213,
    34253,
    34293,
    34513,
    34563,
    34873,
    34993,
    35193,
    36183,
    36593,
    36623,
    38630,//女發自選2
    44820, 38800, 41150, 41720, 41770, 41860, 41930, 41950, 41990, 44330, 44380, 44400, 44510, 41890, 41960,
    41720, 38520, 34450, 37530, 38700, 38680, 38660, 38640, 38600, 38560, 38460, 38410, 37890, 37910, 37950,
    38620, 38710, 38730, 38740, 38760, 38790, 38800, 38810, 38850, 38930, 38940, 32150, 34950, 34940, 34960,
    37310, 37320, 37330, 37340, 37350, 37361, 37370, 37400, 37410, 37420, 37430, 37440, 37450, 37460, 37490,
    37500, 37510, 37520, 37530, 37540, 37550, 37560, 37570, 37580, 37610, 37620, 37630, 37640, 37650, 37660,
    37670, 37680, 37690, 37700, 37710, 37720, 37730, 37740, 37750, 37760, 37770, 37780, 37790, 37800, 37810,
    37820, 37830, 37840, 37850, 37860, 37880, 37900, 37920, 37930, 37940, 37950, 37960, 37970, 37980, 37990,
    38000, 38010, 38020, 38030, 38040, 38050, 38060, 38070, 38080, 38090, 38100, 38110, 38120, 38130, 38150,
    38160, 38220, 38240, 38250, 38260, 38270, 38280, 38290, 38300, 38310, 38320, 38330, 38340, 38350, 38360,
    44930, 41600, 38370, 38380, 38390, 38470, 38500, 38480 //皇家130女髮型
];
//男生臉型
var manStyleFace = [
    20043,
    28300,
    25596,
    23081,
    20035,
    25719,
    23041,
    23086,
    20898,
    20844,
    20068,
    20064,
    23010,
    20044,
    20061,
    20833,
    20187,
    20046,
    23056,
    23020,
    26447,
    23418,
    23042,
    26054, 25029, 25057, 25026, 25031, 25079, 23077, 23028, 20035, 20147, 20462, 20377, 23071, 20092, 20091, 23043,
    23041, 24016, 20044, 20038, 20035, 20047, 20098, 23059, 24057, 23053, 23057, 23033, 23034, 24025, 23014, 23024,
    23017, 23015, 23110, 23021, 24011, 20099, 24001, 21092, 20000, 20001, 20002, 20003, 20004, 20005, 20006, 20007,
    20008, 20009, 20010, 20011, 20012, 20013, 20014, 20015, 20016, 20017, 20018, 20019, 20020, 20021, 20022, 20023,
    20024, 20025, 20026, 20027, 20028, 20029, 20036, 20045, 20037, 20048, 20050, 20051, 20052, 20053, 20055, 20056,
    20058, 20059, 20060, 20062, 20063, 20064, 20065, 20066, 20068, 20067, 20069 //男臉型自選
];
//女生臉型
var womanStyleFace = [
    28000,
    24078,
    26023,
    21333,
    21336,
    21341,
    21382,
    21344,
    21345,
    21377,
    24407,
    21342,
    21331,
    21399,
    25751,
    24350,
    21364,
    21380,
    24384,
    21360,
    24401,
    26125,
    23831,
    26054, 25074, 25044, 21044, 24008, 26003, 24071, 24050, 24057, 23053, 23054, 23064, 23060, 24058, 24020, 24013,
    24126, 23028, 24070, 24168, 24059, 23060, 23064, 23153, 23059, 23753, 23056, 23057, 24056, 24052, 24035, 24041,
    24040, 24039, 24038, 24036, 23034, 23040, 24032, 24031, 21036, 24028, 23808, 24025, 23030, 23029, 24722, 23032,
    21131, 21033, 21145, 21175, 21180, 21179, 21177, 21178, 21193, 21065, 21000, 21001, 21002, 21003, 21004, 21005,
    21006, 21007, 21008, 21009, 21010, 21011, 21012, 21013, 21014, 21015, 21016, 21017, 21018, 21019, 21020, 21021,
    21022, 21023, 21024, 21025, 21026, 21027, 21034, 21043, 21029, 21030, 21046, 21048, 21049, 21050, 21052, 21053,
    21054, 21055, 21056, 21057, 21058, 21059, 21060, 21061, 21062, 21064 //女臉型自選
];
var selection = 0;

function getStyleChoices(gender, currentHair) {
    let color = currentHair % 10;
    let styles;
    if (gender == 0)
        styles = selection == 0 ? manStyleHair : manStyleFace
    else if (gender == 1)
        styles = selection == 0 ? womanStyleHair : womanStyleFace
    for (let i = 0; i < styles.length; i++)
        if (npc.isHairValid(styles[i] + color)) //prefer current hair color
            styles[i] += color;
    return styles;
}


let res, buy;
let isAngel = false;
let isBeta = false;
if (player.getBeginner() == 6001) {
    isAngel = npc.askAngelicBuster() != 0;
} else if (player.getBeginner() == 10000) {
    isBeta = npc.askMenu("請選擇：\r\n#b#L0#神之子：阿爾法#l\r\n#L1#神之子：貝塔#l") != 0;
}
selection = npc.askMenu("您好，請選擇你需要的服務。\r\n#b#L0#自選髮型（使用#v" + itemH + "#）#l\r\n#b#L1#自填程式碼選擇心儀髮型#l\r\n#b#L2#自選臉型（使用#v" + itemF + "#）#l\r\n#b#L3#自填程式碼選擇心儀臉型#l");
switch (selection) {
    case 0:

        var hairs = getStyleChoices(player.getGender(), player.getHair());
        res = npc.askAvatar("我能把你現在的髮型變成全新的髮型。你對現在的髮型不厭倦嗎?只要你有#b#t5150052##k,我就幫你換髮型。慢慢挑選你想要的髮型吧~", hairs, itemH, isAngel, isBeta);
        selection = res[0];
        buy = res[1];

        if (player.hasItem(itemH, 1)) {
            try {
                player.setHair(hairs[selection]);
                player.loseItem(itemH, 1);
                npc.sayNext("完成了,享受你的新髮型吧!");
            } catch (e) {
                npc.sayNext("未知錯誤，請重試！（可能是不支援該髮型更換，可以試試自填程式碼更換）");
            }
        } else {
            npc.sayNext("呃……你好像沒有#v" + itemH + "#啊？很抱歉，沒有#v" + itemH + "#的話，我不能給你做頭髮。");
        }

        break;
    case 1:
        player.runScript("自填程式碼髮型");
        break;
    case 2:
        var faces = getStyleChoices(player.getGender(), player.getFace());

        res = npc.askAvatar("我能把你現在的臉變成全新的臉...你不想換張新的臉嗎?只要有#b#t" + itemF + "##k的話,我就給你做整容手術。慢慢挑選你喜歡的臉吧~", faces, itemF, isAngel, isBeta);
        selection = res[0];
        buy = res[1];
        if (player.hasItem(itemF, 1)) {
            try {
                player.loseItem(itemF, 1);
                player.setFace(faces[selection]);
                npc.sayNext("好了,你的朋友們一定認不出來是你了!");
            } catch (e) {
                npc.sayNext("未知錯誤，請重試！（可能是不支援該臉型更換，可以試試自填程式碼更換）");
            }
        } else {
            npc.sayNext("嗯……看樣子你沒有整容券……很抱歉，沒有整容券的話，我不能給你做整形手術。");
        }
        break;
    case 3:
        player.runScript("自填程式碼臉型");
        break;
}