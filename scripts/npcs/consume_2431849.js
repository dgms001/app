var Icon = [
    Array("星星", "#fEtc/ChatEmoticon/expression/1/0#"),
    Array("彩虹", "#fEffect/ItemEff/1102877/effect/default/0#"),
    Array("猫咪", "#fUI/NameTag/190/w#"),
    Array("猫咪", "#fUI/NameTag/190/c#"),
    Array("猫咪", "#fUI/NameTag/190/e#"),
    Array("兔子", "#fEffect/CharacterEff/1112960/0/1#"),
    Array("星空", "#fUI/GuildMark/BackGround/00001013/16#"),
    Array("骷髅", "#fUI/GuildMark/Mark/Etc/00009000/15#"),
    Array("红心", "#fUI/GuildMark/Mark/Etc/00009001/1#"),
    Array("白脸", "#fUI/GuildMark/Mark/Etc/00009002/4#"),
    Array("皇冠", "#fUI/GuildMark/Mark/Etc/00009004/3#"),
    Array("红灯", "#fUI/GuildMark/Mark/Etc/00009020/1#"),
    Array("王冠", "#fUI/GuildMark/Mark/Etc/00009023/11#"),
    Array("水滴", "#fEffect/BasicEff/MainNotice/Gamsper/Notify/4#"),
    Array("红旗", "#fEffect/BasicEff/MainNotice/BlockBuster/Default/3#"),
    Array("红心", "#fEffect/CharacterEff/1112905/0/0#"),
    Array("云朵", "#fEffect/ItemEff/1102877/effect/default/1#"),
    Array("翅膀", "#fEffect/ItemEff/1102874/effect/ladder/0#"),
    Array("箭矢", "#fEffect/ItemEff/1112003/0/2#"),
    Array("黄鸭", "#fEffect/ItemEff/1004122/effect/default/8#"),
    Array("红点", "#fEffect/CharacterEff/1082588/0/0#"), //红点
    Array("蓝点", "#fEffect/CharacterEff/1082588/3/0#"), //蓝点
    Array("黄星", "#fEffect/CharacterEff/1112924/0/0#"), //黄星
    Array("蓝星", "#fEffect/CharacterEff/1112925/0/0#"), //蓝星
    Array("红星", "#fEffect/CharacterEff/1112926/0/0#"), //红星
    Array("黄星星", "#fUI/UIPVP.img/MiniMapIcon/star#"), //黄星星
    Array("星星", "#fEtc/ChatEmoticon/expression/1/0#"),
    Array("兔子", "#fEffect/CharacterEff/1112960/0/1#"),
    Array("星空", "#fUI/GuildMark/BackGround/00001013/16#"),
    Array("骷髅", "#fUI/GuildMark/Mark/Etc/00009000/15#"),
    Array("红心", "#fUI/GuildMark/Mark/Etc/00009001/1#"),
    Array("白脸", "#fUI/GuildMark/Mark/Etc/00009002/4#"),
    Array("皇冠", "#fUI/GuildMark/Mark/Etc/00009004/3#"),
    Array("红灯", "#fUI/GuildMark/Mark/Etc/00009020/1#"),
    Array("王冠", "#fUI/GuildMark/Mark/Etc/00009023/11#"),
    Array("水滴", "#fEffect/BasicEff/MainNotice/Gamsper/Notify/4#"),
    Array("红旗", "#fEffect/BasicEff/MainNotice/BlockBuster/Default/3#"),
    Array("红心", "#fEffect/CharacterEff/1112905/0/0#"),
    Array("云朵", "#fEffect/ItemEff/1102877/effect/default/1#"),
    Array("翅膀", "#fEffect/ItemEff/1102874/effect/ladder/0#"),
    Array("箭矢", "#fEffect/ItemEff/1112003/0/2#"),
    Array("黄鸭", "#fEffect/ItemEff/1004122/effect/default/8#"),
    Array("王冠", "#fUI/GuildMark/Mark/Etc/00009023/10#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/2#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/3#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/4#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/5#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/6#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/7#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/8#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/9#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/10#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/11#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/12#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/13#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/14#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/15#"),
    Array("灯组", "#fUI/GuildMark/Mark/Etc/00009020/16#"),
    Array("条件", "#fUI/UIWindow2.img/Quest/quest_info/summary_icon/startcondition#"),
    Array("信封", "#fUI/GuildMark/BackGround/00001003/5#"),
    Array("信封", "#fUI/GuildMark/BackGround/00001003/12#"),
    Array("钻石", "#fUI/NameTag/medal/556/w#"),
    Array("钻石", "#fUI/NameTag/medal/556/c#"),
    Array("钻石", "#fUI/NameTag/medal/556/e#"),
    Array("三角", "#fUI/piggyBarMinigame/crunch/5#"),
    Array("蓝点", "#fUI/piggyBarMinigame/crunch/1#"),
    Array("女神", "#fUI/RunnerGame/RunnerGameUI/Effect/ItemEffect_Protect1/3#"),
    Array("拇指", "#fUI/NameTag/medal/10/w#"),
    Array("拇指", "#fUI/NameTag/medal/10/c#"),
    Array("拇指", "#fUI/NameTag/medal/10/e#"),
    Array("成功", "#fUI/UIWindowJP/inputDirectionBattleTrigger/input/0/dear/7#"),
    Array("失败", "#fUI/UIWindowJP/inputDirectionBattleTrigger/input/0/fail/7#"),
    Array("星星", "#fUI/UIWindowGL/FeedbackSystem/Star#"),
    Array("蓝星", "#fEffect/CharacterEff/1003393/1/0#"),
    Array("花朵", "#fEffect/CharacterEff/1050334/2/0#"),
    Array("蓝星", "#fEffect/CharacterEff/1003393/0/0#"),
    Array("淡星", "#fEffect/CharacterEff/moveRandomSprayEff/eunwol_seal/effect/0/2#"),
    Array("花朵", "#fEffect/CharacterEff/1051294/1/0#"),
    Array("花朵", "#fEffect/CharacterEff/1051296/1/0#"),
    Array("金菇", "#fUI/NameTag/medal/74/w#"),
    Array("金菇", "#fUI/NameTag/medal/74/c#"),
    Array("金菇", "#fUI/NameTag/medal/74/e#"),
    Array("蛋糕", "#fUI/NameTag/medal/758/w#"),
    Array("蛋糕", "#fUI/NameTag/medal/758/c#"),
    Array("蛋糕", "#fUI/NameTag/medal/758/e#"),
    Array("胡子", "#fUI/NameTag/124/w#"),
    Array("胡子", "#fUI/NameTag/124/c#"),
    Array("胡子", "#fUI/NameTag/124/e#"),
    Array("帽子", "#fUI/NameTag/nick/312/w#"),
    Array("帽子", "#fUI/NameTag/nick/312/c#"),
    Array("帽子", "#fUI/NameTag/nick/312/e#"),
    Array("圣诞", "#fUI/NameTag/medal/728/w#"),
    Array("圣诞", "#fUI/NameTag/medal/728/c#"),
    Array("圣诞", "#fUI/NameTag/medal/728/e#"),
    Array("红钻", "#fUI/UIWindowPL/DuoEvent/Maximum/DuoInfo/icon/GoodF/0#"),
    Array("王冠", "#fUI/NameTag/medal/468/w#"),
    Array("王冠", "#fUI/NameTag/medal/468/c#"),
    Array("王冠", "#fUI/NameTag/medal/468/e#"),
    Array("确认", "#fUI/CashShop.img/CSCoupon/BtOK/normal/0#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/ladder/0#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/default/7#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/walk1/3#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/jump/0#"),
    Array("音符", "#fEffect/ItemEff/1112811/0/0#"),
    Array("红心", "#fEffect/CharacterEff/1112905/0/0#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/default/0#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/default/1#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/default/2#"),
    Array("幽灵", "#fEffect/ItemEff/1004738/effect/default/3#"),
    Array("金左指标", "#fUI/UIWindow/MonsterBook/arrowLeft/normal/0#"),
    Array("金右指标", "#fUI/UIWindow/MonsterBook/arrowRight/normal/0#"),
    Array("简单", "#fEffect/ItemEff/1102877/effect/default/0#")

];
var sql = "SELECT skill FROM characters_skills WHERE characters_id = ? and masterlevel = 1 and level = 1 and skill > 80000000 and skill < 80200000";
var push = player.customSqlResult(sql, player.getId());

var jobData = [
    //冒险家
    Array("英雄", 112, 111, 100),
    Array("聖騎士", 122, 121, 100),
    Array("黑騎士", 132, 131, 100),
    Array("大魔導士(火、毒)", 212, 211, 100),
    Array("大魔導士(冰、雷)", 222, 221, 100),
    Array("主教", 232, 231, 100),
    Array("箭神", 312, 311, 100),
    Array("神射手", 322, 321, 100),
    Array("夜使者", 412, 411, 100),
    Array("暗影神偷", 422, 421, 100),
    //剑士
    Array("阿戴爾", 15112, 15111, 100),
    Array("狂狼勇士", 2112, 2111, 100),
    Array("惡魔殺手", 3112, 3111, 100),
    Array("惡魔復仇者", 3122, 3121, 100),
    Array("爆拳槍神", 3712, 3711, 100),
    Array("傑諾", 3612, 3611, 100),
    Array("米哈逸", 5112, 5111, 100),
    Array("凱撒", 6112, 6111, 100),
    Array("劍豪", 4112, 4111, 100),
    //法師
    Array("伊利恩", 15212, 15211, 100),
    Array("龍魔導士", 2217, 2214, 100),
    Array("夜光", 2712, 2711, 100),
    Array("煉獄巫師", 3212, 3211, 100),
    Array("陰陽師", 4212, 4211, 100),
    Array("凱內西斯", 14212, 14211, 100),
    Array("拉拉", 16212, 16211, 100),
    Array("幻獸師", 11212, 11211, 100), 
    //弓箭手
    Array("凱殷", 6312, 6311, 100),
    Array("開拓者", 332, 331, 100, 3),
    Array("精靈遊俠", 2312, 2311, 100),
    Array("狂豹獵人", 3312, 3311, 100),

    //盗贼
    Array("虎影", 16412, 16411, 100),
    Array("卡蒂娜", 6412, 6411, 100),
    Array("影武者", 434, 433, 100),
    Array("幻影俠盜", 2412, 2411, 100),
    //海盗
    Array("墨玄", 17512, 17511, 100),
    Array("亞克", 15512, 15511, 100),
    Array("重砲指揮官", 532, 531, 100),
    Array("拳霸", 512, 511, 100),
    Array("槍神", 522, 521, 100),
    Array("機甲戰神", 3512, 3511, 100),
    Array("天使破壞者", 6512, 6511, 100),
    Array("隱月", 2512, 2511, 100), 

    //雪吉拉or品克繽
    //Array("雪吉拉", 13500, 0, 10),
    //Array("皮卡啾", 13100, 0, 10),
    //Array("品克繽", 13100, 13000, 10),//如果轉職可以直接創建品克繽的話就開這裡,//上面的 否則就用新手

    /*騎士團聯盟-------------------*/
    Array("聖魂劍士", 1112, 1111, 100),
    Array("烈焰巫師", 1212, 1211, 100),
    Array("破風使者", 1312, 1311, 100),
    Array("暗夜行者", 1412, 1411, 100),
    Array("閃雷悍將", 1512, 1511, 100)

];
var flag = false;
var needItem = 2431849; //需要物品
var needYE = 1; //需要物品數量
var needLevel = 200; //需要的等級
var free = false;
var text = "需要消耗#v" + needItem + "# x " + needYE + "\r\n";
text +="#r累計贊助達到2w可以免費專職一次[不包含裝備轉換,也沒有這項服務]\r\n"
text +="#b注意累計贊助不是實際贊助\r\n"
text +="#r自由專職不會降低等級 只會清空1-5轉技能和職業新手技能\r\n"
text +="#b轉職前一定要把所有五轉技能脫落\r\n"
text +="#r轉職前一定要把所有五轉技能脫落\r\n"
text +="#b轉職前一定要把所有五轉技能脫落\r\n"
text +=""+Icon[17][1] +"#fs20##fc0xFF00caf2##e冒險家職業群"+Icon[17][1]+"#r#n#fs11#\r\n";
for (var i = 0; i <= 9; i++) {
    text += "#L" + i + "#" + jobData[i][0] + "#l"
}
text +="\r\n\t"+Icon[17][1] +"#fs20##fc0xFF00caf2##e劍士職業群"+Icon[17][1]+"#r#n#fs11#\r\n";
for (var i = 10; i <= 18; i++) {
    text += "#L" + i + "#" + jobData[i][0] + "#l"
}
text +="\r\n\t"+Icon[17][1] +"#fs20##fc0xFF00caf2##e法師職業群"+Icon[17][1]+"#r#n#fs11#\r\n";
for (var i = 19; i <= 26; i++) {
    text += "#L" + i + "#" + jobData[i][0] + "#l"
}
text +="\r\n"+Icon[17][1] +"#fs20##fc0xFF00caf2##e弓箭手職業群"+Icon[17][1]+"#r#n#fs11#\r\n";
for (var i = 27; i <= 30; i++) {
    text += "#L" + i + "#" + jobData[i][0] + "#l"
}
text +="\r\n\t"+Icon[17][1] +"#fs20##fc0xFF00caf2##e盜賊職業群"+Icon[17][1]+"#r#n#fs11#\r\n";
for (var i = 31; i <= 34; i++) {
    text += "#L" + i + "#" + jobData[i][0] + "#l"
}
text +="\r\n\t"+Icon[17][1] +"#fs20##fc0xFF00caf2##e海盜職業群"+Icon[17][1]+"#r#n#fs11#\r\n";
for (var i = 35; i <= 42; i++) {
    text += "#L" + i + "#" + jobData[i][0] + "#l"
}
text +="\r\n"+Icon[17][1] +"#fs20##fc0xFF00caf2##e騎士團職業群"+Icon[17][1]+"#r#n#fs11#\r\n";
for (var i = 43; i <= 47; i++) {
    text += "#L" + i + "#" + jobData[i][0] + "#l"
}
var selected = npc.askMenu(text);
if (!player.hasItem(needItem, needYE) && !free) {
    npc.say("你沒有#v" + needItem + "# x " + needYE + "，如需轉職，請前往餘額商城購買#v" + needItem + "#");
} else if (player.getLevel() < needLevel) {
    npc.say("#b您的等級不足！需要" + needLevel + "級");
} else if (player.getFreeSlots(1) < 5 || player.getFreeSlots(2) < 5 || player.getFreeSlots(3) < 5 || player.getFreeSlots(4) < 5 || player.getFreeSlots(5) < 5) {
    npc.say("包裹空間不足，請確保包裹每個欄位有至少 " + 5 + " 格空間", 9010061);
} else {
    var YN = npc.askYesNo("#e#r重要！！注意事項！！:\r\n1.請把五轉技能全部解除安裝再使用,以免出現BUG！\r\n2.初始化快捷鍵為預設快捷鍵#b\r\n#n是否轉職成為" + jobData[selected][0] + "?");
    if (YN == 1) {
        player.setJob(jobData[selected][1]);
        player.resetHyperSkill();
        player.resetHyperStatSkill();
        player.resetSkills();
        //player.resetStats(4, 4, 4, 4);
        player.resetVSkills();
        player.gainItem(2431305, 1);
        player.gainItem(2501001, 1);
        player.gainItem(2500000, 1);
        player.loseItem(needItem, needYE)
        //如果是異人 要學習技能
        player.maxSkills(); //滿技能
        if (push.size() > 0) {
            for (var i = 0; i < push.size(); i++) {
                player.setSkillLevel(Number(push.get(i).get("skill")), 1, 1, false);
            }
        }
        npc.broadcastPlayerNotice(13, "== 自由轉職 ==:玩家 " + player.getName() + " 透過自由轉職，轉職成為了 <" + jobData[selected][0] + "> 好好享受你的新職業叭！");
        npc.say("轉職成功！贈送您 #v2431305#， #v2501001#， #v2500000#。");

    }
}

function getHyPay(type) {
    var sql = "select * from hypay where accname = '" + getAccountName() + "'";
    var push = player.customSqlResult(sql);
    if (push.size() > 0) {
        var result = push.get(0);
        if (type == 1) {
            var pay = result.get("pay");
        } else if (type == 2) {
            var pay = result.get("payUsed");
        } else if (type == 3) {
            var pay = result.get("payReward");
        }
    } else {
        player.customSqlInsert("INSERT INTO `hypay` (`accname`, `name`) VALUES ('" + getAccountName() + "', '" + player.getName() + "')");
        return getHyPay(1);
    }

    return pay;
}

function getAccountName() {
    var i = -1;
    var sql = "select name,id from accounts where id=" + player.getAccountId() + " order by name limit 1;";
    var push = player.customSqlResult(sql);
    if (push.size() > 0) {
        var result = push.get(0);
        var name = result.get("name");
    }

    return name;
}

function gainHyPay(count) {
    var sql = "update hypay set pay =pay+? where accname = '" + getAccountName() + "';";
    player.customSqlUpdate(sql, count);
}

//flag = true 查總的不重置
//flag = false 查當天的
function getEventValue(event1, flag) {
    var charInfo = getCharInfo();
    if (flag) {
        var sql = "select sum(value) as numbe from zz_xr_event where accounts_id = " + parseInt(charInfo.accounts_id) + " and event = '" + event1 + "' and world =" + parseInt(charInfo.world) + " ";
    } else {
        var sql = "select sum(value) as numbe from zz_xr_event where accounts_id = " + parseInt(charInfo.accounts_id) + " and event = '" + event1 + "' and world =" + parseInt(charInfo.world) + " AND DATE_FORMAT(time, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d') ";
    }
    var resultList = player.customSqlResult(sql);
    var count = 0;
    for (var i = 0; i < resultList.size(); i++) {
        var result = resultList.get(i);
        if (result == null) {
            break;
        }
        count = result.get("numbe");
        if (count == null) {
            count = 0;
        }
    }
    return parseInt(count);
}

function setEventValue(event1, value1) {
    var charInfo = getCharInfo();
    var sql = "insert into zz_xr_event(accounts_id, world, `event`,`value`,time) values(" + charInfo.accounts_id + "," + charInfo.world + ",'" + event1 + "'," + value1 + ",now())";
    player.customSqlInsert(sql);
}

function getCharInfo() {
    var sql = "SELECT accountid accounts_id,world FROM characters where id = " + player.getId() + "";
    var resultList = player.customSqlResult(sql);
    var charInfo = {};
    for (var i = 0; i < resultList.size(); i++) {
        var result = resultList.get(i);
        if (result == null) {
            break;
        }
        charInfo.accounts_id = result.get("accounts_id");
        charInfo.world = result.get("world");
    }
    return charInfo;
}
